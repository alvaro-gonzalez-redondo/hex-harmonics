<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hexagonal Harmonic Map | Microtonal Visualizer</title>
    <meta name="description" content="Interactive musical harmony explorer on a hexagonal grid. Support for microtonal tunings (12, 19, 31, 53, 72 ODE) and audio synthesis.">

    <!-- Open Graph / Facebook / Discord -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Hexagonal Harmonic Map">
    <meta property="og:description" content="Explore harmonic consanguinity and microtonality visually.">
    <!-- Si tienes una captura de pantalla, ponla en el repo y enl√°zala aqu√≠ -->
    <!-- <meta property="og:image" content="https://tu-usuario.github.io/tu-repo/screenshot.jpg"> -->

    <link rel="stylesheet" href="style.css">

    <!-- Favicon simple (un hex√°gono emoji) para evitar errores 404 en consola -->
    <link rel="icon" type="image/x-icon" href="favicon.png">
</head>
<body>
    <!-- Panel de Control de Acordes (Arriba Centro) -->
    <div id="chordBar">
        <div id="slotDisplay">Slot 1</div>
        <div class="chord-controls">
            <button id="btnClearSlot" class="btn-mini btn-yellow" title="Clear current chord">‚úñ Chord</button>
            <button id="btnClearAll" class="btn-mini btn-red" title="Clear all chords">‚úñ All</button>
        </div>
    </div>

    <!-- Panel UI Principal -->
    <div id="ui">
        <div class="panel-header" id="uiHeader">
            <span>‚öôÔ∏è Configuration</span>
            <span class="toggle-icon">‚ñº</span>
        </div>
        <div class="panel-content" id="uiContent">
            <div><strong>System (EDO)</strong></div>
            <select id="edoSelect">
                <option value="12">12 TET</option>
                <option value="19">19 TET</option>
                <option value="31">31 TET</option>
                <option value="53">53 TET</option>
                <option value="72">72 TET</option>
            </select>

            <label>Light Sensibility</label>
            <input type="range" id="sensSlider" min="5" max="80" value="80">

            <label>Rational Filter</label>
            <div class="slider-labels"><span>Exact</span><span>Simple</span></div>
            <input type="range" id="complexitySlider" min="0.5" max="10.0" step="0.1" value="10.0">

            <div class="info" id="cellInfo">Touch to activate notes.</div>

            <fieldset style="border:1px solid #444; padding:5px; margin-top:10px;">
                <legend style="font-size:0.8em; color:#aaa;">Visual Filters</legend>

                <!-- Filtros de L√≠mite Primo -->
                <div style="font-size:0.7em; margin-bottom:5px;">Limit Colors:</div>
                <div id="limitFilters" style="display:flex; flex-wrap:wrap; gap:5px; font-size:0.7em;">
                    <!-- Se generar√°n din√°micamente en JS -->
                </div>

                <!-- Componentes de Brillo -->
                <div style="font-size:0.7em; margin-top:8px; margin-bottom:5px;">Light Factors:</div>
                <div style="font-size:0.7em; display:flex; flex-direction:column; gap:2px;">
                    <label><input type="checkbox" id="chkConsonance" checked> Consonance (Physics)</label>
                    <label><input type="checkbox" id="chkClarity" checked> Clarity (Mathematics)</label>
                    <label><input type="checkbox" id="chkTuning" checked> Tuning (Accuracy)</label>
                </div>

                <!-- Slider Plomp-Levelt -->
                <div style="font-size:0.7em; margin-top:8px;">
                    Bandwidth (Roughness): <span id="bwValue">1.0</span>x
                </div>
                <input type="range" id="bandwidthSlider" min="0.1" max="2.0" step="0.1" value="1.0">
            </fieldset>

            <!-- Bot√≥n MIDI Manual -->
            <button id="btnMidi" style="margin-top:15px; width:100%; background:#444; color:#ccc;" class="btn">
                üéπ Activate MIDI
            </button>
            <div id="midiStatus" style="font-size:0.7em; text-align:center; margin-top:5px; color:#666; display:none;"></div>

            <button id="btnFullscreen" class="btn" style="margin-top:5px; width:100%; background:#333;">‚õ∂ Full Screen</button>
        </div>
    </div>

    <!-- Leyenda (Estructura colapsable) -->
    <div id="legend">
        <!-- Cabecera que recibir√° el click -->
        <div class="panel-header" id="legendHeader">
            <span>üé® Legend</span>
            <span class="toggle-icon">‚ñº</span>
        </div>
        <!-- Contenido que se ocultar√° (AQU√ç ES DONDE FALTABA EL ID) -->
        <div class="panel-content" id="legendContent"></div>
    </div>

    <!-- Visualizador Lineal (Ahora con cabecera colapsable) -->
    <div id="linearContainerWrapper" style="position: absolute; bottom: 0; left: 0; width: 100%; z-index: 5;">

        <!-- Cabecera -->
        <div class="panel-header" id="linearHeader" style="background: rgba(15,15,15,0.95); padding: 5px 10px; border-top: 1px solid #444; margin: 0; color: #aaa; font-size: 0.8em;">
            <span>üìè Linear Visualizer</span>
            <span class="toggle-icon">‚ñº</span>
        </div>

        <!-- Contenido (Canvas) -->
        <div class="panel-content" id="linearContent" style="background: rgba(15,15,15,0.95); height: 120px; transition: height 0.3s ease;">
            <canvas id="linearCanvas"></canvas>
        </div>
    </div>

    <!-- Controles de Audio -->
    <div id="audioControls">
        <button id="btnChord" class="btn btn-chord">Chord (Space)</button>
        <button id="btnArp" class="btn btn-arp">Arpeggio (Shift+Space)</button>
    </div>

    <!-- Canvas Principal -->
    <canvas id="hexCanvas"></canvas>

    <!-- Punto de entrada JS -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
